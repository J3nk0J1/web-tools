<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video Compressor</title>
  <link rel="stylesheet" href="../../css/styles.css" />
  <link rel="stylesheet" href="./video-compressor.css" />
  <link rel="icon" href="../../assets/icons/app-logo.svg" type="image/svg+xml" />
</head>
<body data-root="../.." data-page="tool">
  <header class="app-bar" role="banner">
    <div class="app-bar__content">
      <div class="app-bar__left">
        <button id="backToDashboard" class="icon-btn back-btn" aria-label="Back to dashboard" title="Back to dashboard" data-ripple>
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </span>
        </button>
        <img src="../../assets/icons/app-logo.svg" class="app-logo" alt="Intranet Tools logo" />
        <div class="app-brand">
          <span class="app-title">Intranet Tools</span>
          <span class="app-subtitle">Creative suite for secure teams</span>
        </div>
      </div>
      <div class="app-bar__right">
        <button id="themeToggle" class="icon-btn" aria-label="Toggle light or dark theme" title="Toggle theme" data-ripple>
          <span class="icon" id="themeIcon" aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </header>

  <div class="global-notice notice-bar notice-bar--important" role="note" aria-live="polite">
    <div class="notice-bar__icon" aria-hidden="true">⚠️</div>
    <p class="global-notice__text">Important Notice: This tool is provided as is without warranty or support. Please do not contact the ICT service desk—no support will be offered.</p>
  </div>

  <section class="tool-lede" data-tool-lede data-tool-id="video-compressor"></section>

  <div class="notice-bar notice-bar--inline" role="note" aria-live="polite">
    <div class="notice-bar__icon" aria-hidden="true">⚠️</div>
    <div class="notice-bar__content">
      <p class="notice-bar__title">Performance reminder</p>
      <p class="notice-bar__text">Encoding large videos in the browser is CPU intensive. Keep the tab focused, plug in your device, and expect the process to take several minutes per clip.</p>
    </div>
  </div>

  <main class="tool-main" role="main">
    <section class="tool-section" aria-labelledby="upload-title">
      <h2 id="upload-title">Step 1 — Pick a source video</h2>
      <div id="dropzone" class="dropzone" tabindex="0">
        <p>Drag & drop a video here, or</p>
        <button id="chooseFileBtn" class="btn" type="button" data-ripple>Choose file</button>
        <input id="fileInput" type="file" accept="video/*" style="display:none" />
        <p class="dropzone__hint">MP4, MOV, MKV, WebM and other common formats are supported.</p>
      </div>
    </section>

    <section class="tool-section" aria-labelledby="analysis-title" id="analysisPanel" hidden>
      <h2 id="analysis-title">Step 2 — Automatic analysis</h2>
      <div class="analysis-grid">
        <div>
          <h3 class="panel-title">Source details</h3>
          <ul class="meta-list" id="sourceDetails"></ul>
        </div>
        <div>
          <h3 class="panel-title">Recommended targets</h3>
          <ul class="meta-list" id="recommendationList"></ul>
          <p class="hint">Targets stay under <strong>100&nbsp;MB</strong>. Resolution is reduced only when the bitrate would otherwise be too low.</p>
        </div>
      </div>
    </section>

    <section class="tool-section" aria-labelledby="settings-title" id="settingsPanel" hidden>
      <h2 id="settings-title">Step 3 — Output settings</h2>
      <div class="settings-grid">
        <div class="field">
          <label for="formatSelect">Preferred output format</label>
          <select id="formatSelect" class="input">
            <option value="auto">Auto — choose the best option</option>
            <option value="mp4">MP4 (H.264/AAC)</option>
            <option value="webm">WebM (VP9/Opus)</option>
          </select>
          <p class="field-hint">Auto prioritises patent-free WebM/VP9 when quality allows, otherwise falls back to MP4/H.264 for maximum compatibility.</p>
        </div>
        <div class="field">
          <label for="resolutionSelect">Resolution</label>
          <select id="resolutionSelect" class="input">
            <option value="auto">Auto — shrink only if the bitrate is too low</option>
            <option value="source">Match source resolution</option>
            <option value="2160p" data-width="3840" data-height="2160">4K UHD (2160p)</option>
            <option value="1440p" data-width="2560" data-height="1440">1440p (QHD)</option>
            <option value="1080p" data-width="1920" data-height="1080">1080p (Full HD)</option>
            <option value="720p" data-width="1280" data-height="720">720p (HD)</option>
            <option value="540p" data-width="960" data-height="540">540p (qHD)</option>
            <option value="480p" data-width="854" data-height="480">480p (SD Wide)</option>
            <option value="360p" data-width="640" data-height="360">360p (SD)</option>
            <option value="custom">Custom…</option>
          </select>
          <div class="field__inline" id="customResolution" hidden>
            <input id="resolutionWidth" type="number" class="input input--small" min="160" max="7680" step="2" aria-label="Custom width" />
            <span class="unit" aria-hidden="true">×</span>
            <input id="resolutionHeight" type="number" class="input input--small" min="160" max="4320" step="2" aria-label="Custom height" />
            <span class="unit" aria-hidden="true">px</span>
          </div>
          <p class="field-hint">Auto mode keeps the original resolution unless the bitrate would fall below visually safe levels. Custom values are rounded to even numbers.</p>
        </div>
        <div class="field">
          <label for="targetSize">Target size</label>
          <input id="targetSize" type="number" class="input" min="20" max="100" value="100" step="5" />
          <p class="field-hint">Maximum output size in MB. Values above 100&nbsp;MB may stall thin clients.</p>
        </div>
        <div class="field">
          <label for="safetySlider">Quality bias</label>
          <input id="safetySlider" type="range" min="85" max="98" value="94" />
          <div class="meta">Reserve <span id="safetyLabel">6</span>% headroom to avoid overshooting the target size.</div>
        </div>
        <div class="field">
          <label for="videoBitrateMode">Video bitrate</label>
          <select id="videoBitrateMode" class="input">
            <option value="auto">Auto — derive from the target size</option>
            <option value="manual">Manual override</option>
          </select>
          <div class="field__inline" id="videoBitrateManual" hidden>
            <input id="videoBitrate" type="number" class="input input--small" min="250" max="50000" step="50" aria-describedby="videoBitrateHint" />
            <span class="unit" aria-hidden="true">Kbps</span>
          </div>
          <p class="field-hint" id="videoBitrateHint">Manual mode ignores the target size slider and uses the bitrate you provide.</p>
        </div>
        <div class="field">
          <label for="fpsSelect">Frame rate</label>
          <select id="fpsSelect" class="input">
            <option value="auto">Auto — match the detected frame rate</option>
            <option value="60">60 fps</option>
            <option value="50">50 fps</option>
            <option value="48">48 fps</option>
            <option value="30">30 fps</option>
            <option value="25">25 fps</option>
            <option value="24">24 fps</option>
            <option value="15">15 fps</option>
            <option value="custom">Custom…</option>
          </select>
          <div class="field__inline" id="customFpsWrap" hidden>
            <input id="fpsInput" type="number" class="input input--small" min="12" max="60" step="1" aria-label="Custom frame rate" />
            <span class="unit" aria-hidden="true">fps</span>
          </div>
          <p class="field-hint">Lower frame rates shrink files but may introduce judder. Values are clamped between 12&nbsp;fps and 60&nbsp;fps.</p>
        </div>
        <div class="field">
          <label for="audioMode">Audio</label>
          <select id="audioMode" class="input">
            <option value="auto">Auto — include when detected</option>
            <option value="force">Force include (even if undetected)</option>
            <option value="mute">Mute audio</option>
          </select>
          <div class="field__inline" id="audioBitrateWrap">
            <input id="audioBitrate" type="number" class="input input--small" min="32" max="512" step="16" aria-describedby="audioBitrateHint" />
            <span class="unit" aria-hidden="true">Kbps</span>
          </div>
          <p class="field-hint" id="audioBitrateHint">Choose the Opus/AAC bitrate for the output. Set to mute to strip the audio track entirely.</p>
        </div>
        <div class="callout" role="status" aria-live="polite">
          <strong id="etaStrong">Encoding estimate: —</strong>
          <p id="etaCopy">Load a video to calculate an estimated time to completion.</p>
        </div>
      </div>
    </section>

    <section class="tool-section" aria-labelledby="run-title" id="runPanel" hidden>
      <h2 id="run-title">Step 4 — Compress</h2>
      <p class="hint">The encoder captures the video through the browser's MediaRecorder API. Close other heavy applications and keep the device awake.</p>
      <div class="actions">
        <button id="startBtn" class="btn" data-ripple disabled>Start compression</button>
        <button id="resetBtn" class="btn btn--secondary" data-ripple>Start over</button>
      </div>
      <div class="warning-banner" id="runtimeWarning" role="alert" aria-live="assertive" hidden>
        ⚠️ Expect the tab to become busy while compressing. Estimated time: <span id="etaInline">—</span>.
      </div>
      <div class="progress" aria-hidden="true" id="progressWrap">
        <div class="progress__bar" id="progressBar"></div>
      </div>
      <output id="logOutput" class="log" role="status" aria-live="polite"></output>
    </section>

    <section class="tool-section" aria-labelledby="result-title" id="resultPanel" hidden>
      <h2 id="result-title">Result</h2>
      <div class="results">
        <div class="stats" id="resultStats"></div>
        <div class="actions">
          <a id="downloadLink" class="btn" href="#" download data-ripple>Download compressed video</a>
          <button id="encodeAgain" class="btn btn--secondary" type="button" data-ripple>Compress another</button>
        </div>
      </div>
    </section>
  </main>

  <script src="../../js/tool-data.js"></script>
  <script src="../../js/app.js"></script>
  <script type="module" src="./video-compressor.js"></script>
</body>
</html>
