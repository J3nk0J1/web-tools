<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video Compressor</title>
  <link rel="stylesheet" href="../../css/styles.css" />
  <link rel="stylesheet" href="./video-compressor.css" />
  <link rel="icon" href="../../assets/icons/app-logo.svg" type="image/svg+xml" />
</head>
<body>
  <header class="app-bar" role="banner">
    <div class="app-bar__left">
      <button id="backToDashboard" class="icon-btn back-btn" aria-label="Back to dashboard" title="Back to dashboard" data-ripple>
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </span>
      </button>
      <img src="../../assets/icons/video-compressor.svg" class="app-logo" alt="Video Compressor icon" />
      <h1 class="app-title">Video Compressor</h1>
    </div>
    <div class="app-bar__right">
      <button id="themeToggle" class="icon-btn" aria-label="Toggle light/dark theme" title="Toggle theme" data-ripple>
        <span class="icon" id="themeIcon" aria-hidden="true"></span>
      </button>
    </div>
  </header>

  <aside class="notice-bar notice-bar--important" role="note" aria-live="polite">
    <strong>⚠️ Important:</strong>
    <span class="notice-bar__text">Encoding large videos in the browser is CPU intensive. Keep the tab focused, plug in your device, and expect the process to take several minutes per clip.</span>
  </aside>

  <main class="tool-content" role="main">
    <section class="panel" aria-labelledby="upload-title">
      <h2 id="upload-title">Step 1 — Pick a source video</h2>
      <div id="dropzone" class="dropzone" tabindex="0">
        <p>Drag & drop a video here, or</p>
        <button id="chooseFileBtn" class="btn" type="button" data-ripple>Choose file</button>
        <input id="fileInput" type="file" accept="video/*" style="display:none" />
        <p class="dropzone__hint">MP4, MOV, MKV, WebM and other common formats are supported.</p>
      </div>
    </section>

    <section class="panel" aria-labelledby="analysis-title" id="analysisPanel" hidden>
      <h2 id="analysis-title">Step 2 — Automatic analysis</h2>
      <div class="analysis-grid">
        <div>
          <h3 class="panel-title">Source details</h3>
          <ul class="meta-list" id="sourceDetails"></ul>
        </div>
        <div>
          <h3 class="panel-title">Recommended targets</h3>
          <ul class="meta-list" id="recommendationList"></ul>
          <p class="hint">Targets stay under <strong>100&nbsp;MB</strong>. Resolution is reduced only when the bitrate would otherwise be too low.</p>
        </div>
      </div>
    </section>

    <section class="panel" aria-labelledby="settings-title" id="settingsPanel" hidden>
      <h2 id="settings-title">Step 3 — Output settings</h2>
      <div class="settings-grid">
        <div class="field">
          <label for="formatSelect">Preferred output format</label>
          <select id="formatSelect" class="input">
            <option value="auto">Auto — choose the best option</option>
            <option value="mp4">MP4 (H.264/AAC)</option>
            <option value="webm">WebM (VP9/Opus)</option>
          </select>
          <p class="field-hint">Auto prioritises patent-free WebM/VP9 when quality allows, otherwise falls back to MP4/H.264 for maximum compatibility.</p>
        </div>
        <div class="field">
          <label for="targetSize">Target size</label>
          <input id="targetSize" type="number" class="input" min="20" max="100" value="100" step="5" />
          <p class="field-hint">Maximum output size in MB. Values above 100&nbsp;MB may stall thin clients.</p>
        </div>
        <div class="field">
          <label for="safetySlider">Quality bias</label>
          <input id="safetySlider" type="range" min="85" max="98" value="94" />
          <div class="meta">Reserve <span id="safetyLabel">6</span>% headroom to avoid overshooting the target size.</div>
        </div>
        <div class="callout" role="status" aria-live="polite">
          <strong id="etaStrong">Encoding estimate: —</strong>
          <p id="etaCopy">Load a video to calculate an estimated time to completion.</p>
        </div>
      </div>
    </section>

    <section class="panel" aria-labelledby="run-title" id="runPanel" hidden>
      <h2 id="run-title">Step 4 — Compress</h2>
      <p class="hint">The encoder captures the video through the browser's MediaRecorder API. Close other heavy applications and keep the device awake.</p>
      <div class="actions">
        <button id="startBtn" class="btn" data-ripple disabled>Start compression</button>
        <button id="resetBtn" class="btn btn--secondary" data-ripple>Start over</button>
      </div>
      <div class="warning-banner" id="runtimeWarning" role="alert" aria-live="assertive" hidden>
        ⚠️ Expect the tab to become busy while compressing. Estimated time: <span id="etaInline">—</span>.
      </div>
      <div class="progress" aria-hidden="true" id="progressWrap">
        <div class="progress__bar" id="progressBar"></div>
      </div>
      <output id="logOutput" class="log" role="status" aria-live="polite"></output>
    </section>

    <section class="panel" aria-labelledby="result-title" id="resultPanel" hidden>
      <h2 id="result-title">Result</h2>
      <div class="results">
        <div class="stats" id="resultStats"></div>
        <div class="actions">
          <a id="downloadLink" class="btn" href="#" download data-ripple>Download compressed video</a>
          <button id="encodeAgain" class="btn btn--secondary" type="button" data-ripple>Compress another</button>
        </div>
      </div>
    </section>
  </main>

  <script src="../../js/app.js"></script>
  <script type="module" src="./video-compressor.js"></script>
</body>
</html>
