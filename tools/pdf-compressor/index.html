<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Compressor</title>
  <link rel="stylesheet" href="../../css/styles.css" />
  <link rel="icon" href="../../assets/icons/app-logo.svg" type="image/svg+xml" />
  <style>
    .panel { margin-bottom: 16px; }
    .progress { border:1px solid var(--divider); border-radius:999px; overflow:hidden; height:12px; background:color-mix(in oklab, var(--surface) 70%, var(--divider)); }
    .progress__bar { height:100%; width:0%; background:var(--primary); transition:width .2s ease; }
    .results { display:flex; flex-direction:column; gap:12px; }
    .stats { display:grid; gap:6px; color:var(--text-muted); }
    .stats strong { color:var(--text); }
    .hint { color:var(--text-muted); }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    #fileInput { display:none; }
    .badge { display:inline-flex; align-items:center; gap:6px; background:color-mix(in oklab, var(--primary) 18%, transparent); color:var(--primary); border-radius:999px; padding:4px 10px; font-size:.85rem; font-weight:600; }
    .settings-layout { display:grid; gap:24px; align-items:start; }
    @media (min-width: 960px){
      .settings-layout { grid-template-columns: minmax(280px,1fr) minmax(320px,1fr); }
    }
    .field-group { display:grid; gap:18px; }
    .output-options { display:grid; gap:12px; }
    .option-card { display:flex; gap:12px; border:1px solid color-mix(in oklab, var(--primary) 24%, transparent); border-radius:14px; padding:14px 16px; background:color-mix(in oklab, var(--primary) 10%, transparent); transition:border-color .2s ease, box-shadow .2s ease; cursor:pointer; }
    .option-card:focus-within, .option-card:hover { border-color:var(--primary); box-shadow:0 0 0 3px color-mix(in oklab, var(--primary) 20%, transparent); }
    .option-card input { margin-top:4px; accent-color:var(--primary); }
    .option-card__content { display:flex; flex-direction:column; gap:4px; }
    .option-card__title { font-weight:600; color:var(--text); }
    .option-card__description { font-size:0.9rem; color:var(--text-muted); }
    .actions--inline { margin-top:16px; }
    .steps { margin:0; padding-left:20px; display:grid; gap:6px; }
    .steps li { font-weight:500; }
    .callout { border-radius:12px; border:1px solid color-mix(in oklab, var(--primary) 40%, transparent); background:color-mix(in oklab, var(--primary) 12%, transparent); padding:12px 14px; }
    .callout strong { color:var(--primary); }
    .error-banner { display:none; margin:16px auto 0; max-width:1100px; background:color-mix(in oklab, var(--error) 18%, transparent); color:var(--error); border:1px solid color-mix(in oklab, var(--error) 40%, transparent); border-radius:12px; padding:12px 16px; box-shadow:var(--shadow-1); }
    .notice-bar { max-width:1100px; margin:16px auto 0; padding:10px 14px; border-radius:12px; display:flex; gap:10px; align-items:flex-start; font-size:.95rem; box-shadow:var(--shadow-1); border:1px solid var(--divider); background:color-mix(in oklab, var(--surface) 80%, transparent); }
    .notice-bar + .notice-bar { margin-top:10px; }
    .notice-bar__icon { font-size:1.1rem; line-height:1; }
    .notice-bar__content { margin:0; }
    .notice-bar__content strong { display:block; font-size:1rem; margin-bottom:2px; }
    .notice-bar--warning { border-color:color-mix(in oklab, var(--warning-border) 70%, transparent); background:color-mix(in oklab, var(--warning-bg) 75%, transparent); color:var(--warning-text); }
    .notice-bar--info { border-color:color-mix(in oklab, var(--primary) 18%, transparent); background:color-mix(in oklab, var(--primary) 9%, transparent); color:var(--text); }
    .error-banner[aria-hidden="false"] { display:block; }
  </style>
</head>
<body>
  <header class="app-bar" role="banner">
    <div class="app-bar__left">
      <button id="backToDashboard" class="icon-btn back-btn" aria-label="Back to dashboard" title="Back to dashboard" data-ripple>
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </span>
      </button>
      <img src="../../assets/icons/pdf-compressor.svg" class="app-logo" alt="PDF compressor icon" />
      <h1 class="app-title">Offline PDF Compressor</h1>
    </div>
    <div class="app-bar__right">
      <button id="themeToggle" class="icon-btn" aria-label="Toggle light/dark theme" title="Toggle theme" data-ripple>
        <span class="icon" id="themeIcon" aria-hidden="true"></span>
      </button>
    </div>
  </header>

  <aside class="notice-bar notice-bar--warning" role="note" aria-live="polite">
    <span class="notice-bar__icon" aria-hidden="true">⚠️</span>
    <p class="notice-bar__content"><strong>Important</strong> This tool is provided as is without warranty or support. Do not contact the ICT service desk; no support will be offered.</p>
  </aside>
  <aside class="notice-bar notice-bar--info" role="note" aria-live="polite">
    <span class="notice-bar__icon" aria-hidden="true">ℹ️</span>
    <p class="notice-bar__content"><strong>Offline only</strong> Files never leave this workstation. All processing happens locally in your browser.</p>
  </aside>
  

  <main class="tool-content" role="main">
    <section class="panel" aria-labelledby="overview-title" id="panel-overview">
      <h2 id="overview-title">How to use this tool</h2>
      <p class="meta">This workflow trims PDFs for easy sharing while staying on your computer. Follow the three steps below.</p>
      <ol class="steps">
        <li><strong>Step 1:</strong> Add the PDF you want to shrink.</li>
        <li><strong>Step 2:</strong> Decide whether you need an everyday copy or the National Archives (NAA) archival standard.</li>
        <li><strong>Step 3:</strong> Download the lighter file once processing finishes.</li>
      </ol>
      <br>
      <div class="callout" role="note">
        <strong>About the National Archives Act (NAA):</strong> This Australian law makes sure government records are preserved and easy to find for future generations. Choosing the NAA archival option automatically applies the preservation settings that meet these obligations.
      </div>
    </section>

    <section class="panel" aria-labelledby="upload-title" id="panel-upload">
      <h2 id="upload-title">Step 1 – Select a PDF</h2>
      <p class="meta">Pick any PDF version 1.2–2.0. Everything stays in the browser – no files are uploaded.</p>
      <div id="dropzone" class="dropzone" tabindex="0">
        <p>Drag &amp; drop a PDF here, or</p>
        <button id="chooseFileBtn" class="btn" type="button" data-ripple>Choose file</button>
        <input id="fileInput" type="file" accept="application/pdf" />
      </div>
    </section>

    <section class="panel" aria-labelledby="settings-title" id="panel-settings" hidden>
      <h2 id="settings-title">Step 2 – Pick the output</h2>
      <p class="meta" id="inputMeta"></p>
      <div class="settings-layout">
        <fieldset class="field field--output">
          <legend>Output format</legend>
          <div class="meta">Use an access copy for day-to-day collaboration. Choose archival for the National Archives standard, or custom to fine-tune every setting.</div>
          <div class="output-options" role="list">
            <label class="option-card" role="listitem">
              <input type="radio" name="outputType" value="access" checked />
              <span class="option-card__content">
                <span class="option-card__title">Access copy</span>
                <span class="option-card__description">Balanced for everyday sharing. Applies recommended resolution and quality automatically.</span>
              </span>
            </label>
            <label class="option-card" role="listitem">
              <input type="radio" name="outputType" value="custom" />
              <span class="option-card__content">
                <span class="option-card__title">Custom</span>
                <span class="option-card__description">Take full control of DPI, JPEG quality and page resizing for unique situations.</span>
              </span>
            </label>
            <label class="option-card" role="listitem">
              <input type="radio" name="outputType" value="pdfa" />
              <span class="option-card__content">
                <span class="option-card__title">Archival copy (PDF/A-2b)</span>
                <span class="option-card__description">Meets National Archives requirements. Locks preservation friendly settings and embeds metadata.</span>
              </span>
            </label>
          </div>
        </fieldset>
        <div class="field-group">
          <div class="field">
            <label for="dpi">Rasterisation DPI</label>
            <input id="dpi" type="range" min="72" max="300" step="6" value="150" />
            <div class="meta">Current: <span id="dpiLabel">150</span> dpi. Higher numbers are sharper but larger.</div>
          </div>
          <div class="field">
            <label for="quality">JPEG quality</label>
            <input id="quality" type="range" min="60" max="100" step="5" value="85" />
            <div class="meta">Current: <span id="qualityLabel">85</span>. Higher values keep more detail at the cost of a bigger file.</div>
          </div>
          <div class="field">
            <label for="downscale">Max long edge (pixels)</label>
            <input id="downscale" class="input" type="number" min="1000" max="6000" value="3500" />
            <div class="meta">Optional. Pages larger than this will be proportionally reduced before encoding.</div>
          </div>
        </div>
      </div>
      <p class="meta" id="qualityNotice">Adjust DPI, JPEG quality and maximum page size to balance clarity and size for everyday use.</p>
      <div class="actions">
        <button id="generateBtn" class="btn" data-ripple>Generate output</button>
        <button class="btn btn--secondary" type="button" id="startOverFromSettings" data-ripple>Start over</button>
      </div>
    </section>

    <section class="panel" aria-labelledby="progress-title" id="panel-progress" hidden>
      <h2 id="progress-title">Step 3 – Processing</h2>
      <p class="meta" id="progressStatus" role="status">Waiting…</p>
      <div class="progress" aria-hidden="true"><div class="progress__bar" id="progressBar"></div></div>
      <div class="actions actions--inline" id="progressActions" hidden>
        <button class="btn btn--secondary" type="button" id="startOverFromProgress" data-ripple>Start over</button>
      </div>
    </section>

    <div id="errorBanner" class="error-banner" role="alert" aria-hidden="true"></div>

    <section class="panel" aria-labelledby="results-title" id="panel-results" hidden>
      <h2 id="results-title">Step 4 – Download</h2>
      <div class="results">
        <div class="stats" id="stats"></div>
        <div class="actions">
          <button id="downloadBtn" class="btn" data-ripple disabled>Download</button>
          <button id="resetBtn" class="btn btn--secondary" data-ripple>Start over</button>
        </div>
        <p class="hint">Behind the scenes the file keeps the ZIP and JPEG formats recommended by our records team. Text recognition (OCR) is not added.</p>
      </div>
    </section>
  </main>

  <script src="../../js/app.js"></script>
  <script src="./lib/pdf.min.js"></script>
  <script src="./lib/pdf-lib.min.js"></script>
  <script src="./pdf-compressor.js"></script>
</body>
</html>
